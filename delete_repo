#!/usr/bin/ruby

require 'github_api'

username = ARGV[0]
password_or_token = ARGV[1]
repo_name = ARGV[2]
token = ENV['GITHUB_TOKEN']

if repo_name.nil? || repo_name.empty?
	warn "Usage: delete_repo USERNAME PASSWORD_OR_TOKEN REPO_NAME (or set GITHUB_TOKEN)"
	exit 1
end

begin
	github = if token && !token.empty?
						 Github.new oauth_token: token
					 elsif username && password_or_token
						 Github.new basic_auth: "#{username}:#{password_or_token}"
					 else
						 raise ArgumentError, 'Provide GITHUB_TOKEN or username/password arguments'
					 end

	github.repos.delete username, repo_name
	puts "Deleted repository: #{repo_name}"
rescue StandardError => e
	warn "Failed to delete repository #{repo_name}: #{e.message}"
	exit 1
end

